<h1>Loan Form</h1>
<%= form_for @loan, url: client_loan_path(@loan) do |form| %>
  <div class="mb-3">
  Loan Status: <span class="badge text-bg-secondary"><%= @loan.state_text %></span><br>
    <%= form.label :principal_amount, 'Principal Amount', class: "form-label" %>
    <%= form.text_field :principal_amount, class: "form-control" %><br />
    <%= form.label :interest_rate, 'Interest Rate', class: "form-label" %>
    <%= form.text_field :interest_rate, class: "form-control" %><br>
    <% if @loan.waiting_for_adjustment_acceptance? %>
      <%= form.submit "Change and Request", class: "btn btn-primary" %>
    <% end %>
  </div>
<% end %>
<% if @loan.open? %>
  Amount to Pay: <%= @loan.total_amount_to_pay %>
  <br>
<% end %>

<% if @loan.approved? || @loan.waiting_for_adjustment_acceptance? %>
  <%= link_to "#{@loan.approved? ? "Confirm" : "Accept"}", confirm_client_loan_path(@loan), data: { turbo_method: :patch } %>
<% end %>

<% if @loan.approved? || @loan.waiting_for_adjustment_acceptance? %>
  <%= link_to "Reject", reject_client_loan_path(@loan), data: { turbo_method: :patch } %>
<% end %>

<% if @loan.open? %>
  <%= link_to "Repay", repay_client_loan_path(@loan), data: { turbo_method: :patch } %>
<% end %>
<br>
<%= render partial: "shared/loan_event_logs", locals: {loan: @loan} %>